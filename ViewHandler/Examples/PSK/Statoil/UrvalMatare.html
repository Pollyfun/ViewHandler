<!DOCTYPE html>
<html>
<head>
    <title>Mätare</title>
    <meta charset="utf-8">
    <!-- start Bootstrap subform -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.0/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/js/bootstrap-select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.0/js/bootstrap-datepicker.min.js"></script>
    <!-- end Bootstrap subform -->

    <link rel="stylesheet" href="/Examples/PSK/Statoil/bootstrap_statoil.css" />
    <script src="/Examples/PSK/scriptformglobal.js"></script>
    <script src="/Examples/PSK/viewfilter.js"></script>
    <script src="/Examples/PSK/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <script src="/Examples/PSK/css3-mediaqueries.js"></script>
    <script src="/Examples/PSK/object.keys.js"></script>
    <script src="/Examples/PSK/dropFilter.js"></script> <!-- behöver för konstaner. ATTRIBUTE_EXCLUDED -->
    <script src="/Examples/PSK/Statoil/viewHandlerMatareTerminaler.js"></script>
    <!-- <script src="/Scripts/interface/psk.js"></script>-->
    <script src="/Scripts/interface/psk.js"></script>
</head>

<body onclick="ViewHandler.clickedOnParentForm();" onload="/*getHelpInfo('', 550, 24);*/">

    <form>
        <style>
            div.outercontainer {
                padding-left: 11px;
                padding-top: 20px;
                margin-left: 0px;
            }

            select.hideduringload {
                display: none;
            }
        </style><!-- some styling -->
        <div class="container outercontainer">
            <div class="row">
                <!--------------------------------------- Main controls ------------------------------------->
                <div class="col-xs-12 col-lg-6 col-sm-12 col-md-7">
                    <div class="row">
                        <div class="col-md-8"></div>
                        <div class="col-md-8" style="height:11px">&nbsp</div>
                        <div class="col-md-8 viewnavpath">
                            Mätare / Område
                        </div>
                        <div class="col-md-12"><hr></div>
                        <div class="col-md-12"><label class="select" for="SelectTyp">Välj visningstyp !</label></div>
                        <div class="col-md-4 col-sm-4 col-xs-10">
                            <select name="SelectTyp" id="SelectTyp" class="selectpicker hideduringload" onchange="selectView(this)">
                                <option value="0">Välj visningstyp</option>
                                <option value="1">-------------------------</option>
                                <option value="UtrUrvalMatareOMR.simple">Område</option>
                                <option value="UtrUrvalMatareLAG.simple">Lager</option>
                                <option value="UtrUrvalMatareGDAT.simple">Garantitid</option>
                                <option value="UtrUrvalMatareLEV.simple">Leverantörer</option>
                                <option value="UtrUrvalMatareNR.simple">Serienummer</option>
                                <option value="UtrUrvalMatareSTN.simple">Stationer</option>
                            </select>
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-1"></div>
                        <div class="col-md-3 col-sm-3 col-xs-1">
                        </div>
                        <div class="col-md-3 col-sm-3 col-xs-12">

                            <input type="button" value="Till term/datautr" class="btn btn-default" onclick="gotoTerminaler();" />
                        </div>
                        <div class="col-md-12">&nbsp</div>
                        <div class="col-md-12" id="activefilters">
                            <!-- Summary of active filters -->
                        </div>

                        <div class="col-md-12 spaceFiller" id="subdropdownlabel">
                            <!-- height filler --><label class="select">&nbsp;</label>
                        </div>
                        <div class="col-md-6 col-sm-6 spaceFiller" id="subdropdown">
                            <!-- height filler --><div class="fillerRow"></div>
                        </div>
                        <div class="col-md-3 col-sm-3 spaceFiller" id="subdropdownbutton1">
                        </div>
                        <div class="col-md-3 col-sm-3 spaceFiller" id="subdropdownbutton2">
                        </div>

                        <div class="col-md-12 col-xs-4 spaceFiller">&nbsp;</div>
                        <div class="col-md-12 col-xs-4">&nbsp;</div>
                        <div class="col-md-9 col-sm-9 col-xs-4">
                            <div class="btn-group" role="group" aria-label="...">
                                <button type="button" class="btn btn-default grouped" id="bnResetFilter" onclick="ViewHandler.resetFilter();">
                                    <i class="glyphicon glyphicon-flash"></i>
                                    <span>Nollställ filter</span>
                                </button>
                                <button type="button" class="btn btn-default grouped" onclick="printToExcel();">
                                    <i class="glyphicon glyphicon-save-file"></i>
                                    <span>Hämta till Excel</span>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-2">
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-4">&nbsp</div>
                    </div>
                </div>
                <!--------------------------------------- Totals Area ------------------------------------->
                <div class="col-xs-12 col-lg-6 col-sm-12 col-md-5">
                    <div class="panel panel-default totalsPanel">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-md-6 col-sm-6 col-xs-6"><strong>Produkt</strong></div><div class="col-md-6 col-sm-6 col-xs-6"><strong>Tankplatser</strong></div>
                            </div>
                        </div>
                        <div class="container-fluid panel-body">
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">95</div><div class="col-md-6 col-sm-6 col-xs-6" id="total95"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">98</div><div class="col-md-6 col-sm-6 col-xs-6" id="total98"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">Diesel</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalDiesel"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">Diesel Plus</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalDieselPlus"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">RME</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalRME"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">B100</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalB100"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">E85</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalE85"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">Biogas</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalBiogas"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">AdBlue</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalAdBlue"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">Spolarv</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalSpolarv"></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">Fotogen</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalFotogen"></div></div>
                        </div>
                        <div class="panel-footer">
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">Fysiska enheter</div><div class="col-md-6 col-sm-6 col-xs-6"><div id="totalFysiskaEnheter"></div></div></div>
                            <div class="row"><div class="col-md-6 col-sm-6 col-xs-6">Enskilda stationer</div><div class="col-md-6 col-sm-6 col-xs-6" id="totalEnskildaStationer"></div></div>
                        </div>
                    </div>
                    <div class="row" id="totalProgress" style="padding-left:32px"></div>
                </div>
            </div>
        </div>
        <div id="viewhandler"></div>
    </form>

    <script>
        'use strict';
        var SERVER_DOMAIN = 'http://dev.psksyd.com';        // used when it's a local container. Empty in the real container.
        var viewHandlerDb = '/psk/ViewHandlerBase.nsf';   // hardcoded in the local Container. In the real Container this is done in the HTML Head Content.
        var webdbname = '/kund/statoil/stbygg.nsf';     // hardcoded in the local Container. In the real Container this is done in the HTML Head Content.
        var ID_VIEWHANDLER = 'viewhandler';
        var DEFAULT_CONFIGNAME = 'UtrUrvalMatareOMR.simple';
        var lager = '';
        var leverantor = '';
        var isInitializing = true;  // to avoid double calls to createView when there's more than one dropdown (Lager, Leverantör)
        
        // TODO:
        $(function () {
            lager = $('#SelectLager').val();
            leverantor = $('#SelectLeverantor').val();
            //console.log('LAGER: ' + lager + '      LEVERANTÖR: ' + leverantor);
            createView({ containerId: ID_VIEWHANDLER, configName: DEFAULT_CONFIGNAME, serverDomain: SERVER_DOMAIN, viewHandlerPath: viewHandlerDb });
            isInitializing = false;
        });

        function selectView(dropdown) {
            var configName = dropdown.value;
            //console.log('selectView: ' + dropdown.value);
            isInitializing = true;
            refreshSummaryMatare(true); // reset summary values immediately

            if (configName === 'UtrUrvalMatareLAG.simple')
            {
                $('#subdropdownlabel').html('<!-- LAGER --><label class="select" for="SelectLager">Välj lager !</label>');
                $('#subdropdown').html(
                    '<select name="SelectLager" id="SelectLager" class="selectpicker hideduringlxoad" onchange="selectLager(this);">' +
                    '<option value="">Alla lager</option>' + 
                    '<option>0585</option>' +
                    '<option value="0582" selected>HUVUDLAGER</option>' +
                    '<option value="0581">TRANSITLAGER</option>' +
                    '<option value="0575">TRAFIKSKADADE</option>' +
                    '<option value="0208">Jörgen Lindgren</option>' +
                    '<option value="0207">Robert Alm</option>' +
                    '<option value="0206">Per Åkerlund</option>' +
                    '<option value="0205">Peter Öberg</option>' +
                    '<option value="0204">Benny Pettersson</option>' +
                    '<option value="0203">Rolf Johansson</option>' +
                    '<option value="0202">Robert Kobsa</option>' +
                    '<option value="0201">Christer Johannesson</option>' +
                    '<option value="0100">Skrotade</option>' +
                    '</select>');
                $('.selectpicker').selectpicker();
                $("#SelectLager").change();
                $('#subdropdownbutton1').html(
                    '<button type="button" class="btn btn-default" onclick="javascript:openMatare(\'' + SERVER_DOMAIN + '/kund/statoil/stbygg.nsf/InvMatare?OpenForm&anlnr=0582&urval=1\')">' +
                    '  <i class="glyphicon glyphicon-none"></i>' +
                    '  <span>Ny mätare</span>' +
                    '</button>');
                $('#subdropdownbutton2').html(
                    '<button type="button" class="btn btn-default" onclick="javascript:openTerminal(\'' + SERVER_DOMAIN + '/kund/statoil/stbygg.nsf/InvBetalpelare?OpenForm&anlnr=0582&urval=1\')">' +
                    '  <i class="glyphicon glyphicon-none"></i>' +
                    '  <span>Ny terminal</span>' +
                    '</button>');
            }
            else if (configName === 'UtrUrvalMatareLEV.simple')
            {
                $('#subdropdownlabel').html('<!-- LEVERANTÖR --><label class="select" for="SelectLeverantor">Välj leverantör !</label>');
                $('#subdropdown').html(
                    '<select name="SelectLeverantor" id="SelectLeverantor" class="selectpicker hideduringload" onchange="selectLeverantor(this);">' +
                    '<option value="" selected="selected">Alla leverantörer</option>' +
                    '<option>Övriga</option>' +
                    '<option>Wayne</option>' +
                    '<option>Tokheim</option>' +
                    '<option>Tatsuno</option>' +
                    '<option>Sterners</option>' +
                    '<option>K.Anderson</option>' +
                    '<option>Autotank</option>' +
                    '</select>');
                $('.selectpicker').selectpicker();
                $("#SelectLeverantor").change();
            }
            else {
                $('#subdropdownlabel').html('<label class="select">&nbsp;</label>');
                $('#subdropdown').html('<div class="fillerRow"></div>');
                $('#subdropdownbutton1').html('');
                $('#subdropdownbutton2').html('');
            }
            setTimeout(function () {
                //refreshViewHandler();
                createView({ containerId: ID_VIEWHANDLER, configName: configName, serverDomain: SERVER_DOMAIN, viewHandlerPath: viewHandlerDb });
                isInitializing = false;
            }, 10);   // let the dropdown finish it's operations before replacing the iframe (since it might want to close dropdowns inside the iframe)
        }

        function selectLager(dropdown) {
            lager = dropdown.value;
            //console.log('LAGER: ' + lager);
            if (!isInitializing)
                setTimeout(function () {
                    createView({ containerId: ID_VIEWHANDLER, configName: 'UtrUrvalMatareLAG.simple', serverDomain: SERVER_DOMAIN, viewHandlerPath: viewHandlerDb });
                }, 10);
        }

        function selectLeverantor(dropdown) {
            leverantor = dropdown.value;
            //console.log('LEVERANTÖR: ' + leverantor);
            if (!isInitializing)
                setTimeout(function () {
                    createView({ containerId: ID_VIEWHANDLER, configName: 'UtrUrvalMatareLEV.simple', serverDomain: SERVER_DOMAIN, viewHandlerPath: viewHandlerDb });
                }, 10);
        }

        function openGoogleMaps() {
            console.log('openGoogleMaps..');
        }
        function doSearch() {
            console.log('doSearch..');
        }
        function gotoTerminaler() {
            location.href = 'UrvalTerminaler.html';
        }

    </script>
</body>
</html>